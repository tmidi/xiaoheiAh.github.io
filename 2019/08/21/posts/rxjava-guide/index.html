<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>RxJava入门 | xiaohei&#39;s blog | Java Developer</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content=noodp><meta name=Description content="rxjava入门 背压 观察者模式 map flatmap zip 响应式编程"><link rel=prev href=https://xiaohei.im/2019/08/21/posts/189-rotate-array/><link rel=next href=https://xiaohei.im/2019/08/26/posts/rxjava-in-hystrix/><link rel=canonical href=https://xiaohei.im/2019/08/21/posts/rxjava-guide/><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content=#da532c><meta name=theme-color content=#ffffff><meta name=twitter:card content=summary><meta name=twitter:title content=RxJava入门><meta name=twitter:description content="rxjava入门 背压 观察者模式 map flatmap zip 响应式编程"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"RxJava入门","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/xiaohei.im\/2019\/08\/21\/posts\/rxjava-guide\/"},"image":{"@type":"ImageObject","url":"https:\/\/xiaohei.im\/cover.png","width":800,"height":600},"genre":"posts","keywords":"rxjava, 响应式编程","wordcount":4057,"url":"https:\/\/xiaohei.im\/2019\/08\/21\/posts\/rxjava-guide\/","datePublished":"2019-08-21T16:09:48\x2b08:00","dateModified":"2019-08-21T16:09:48\x2b08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"XXXX","logo":{"@type":"ImageObject","url":"https:\/\/xiaohei.im\/logo.png","width":127,"height":40}},"description":"rxjava入门 背压 观察者模式 map flatmap zip 响应式编程"}</script><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.10.1/css/all.min.css integrity="sha256-fdcFNFiBMrNfWL6OcAGQz6jDgNTRxnrLEd4vJYFWScE=" crossorigin=anonymous><link rel=stylesheet href=/css/lib/animate/animate.min.min.css></head><body><script>window.isDark=(window.localStorage&&window.localStorage.getItem('theme'))==='dark';window.isDark&&document.body.classList.add('dark-theme');</script><div class=wrapper><nav class=navbar><div class=navbar-container><div class="navbar-header animated bounceIn"><a href=https://xiaohei.im/>xiaohei&#39;s blog | Java Developer</a></div><div class=navbar-menu><a class=menu-item href=https://xiaohei.im/posts/>文章</a>
<a class=menu-item href=https://xiaohei.im/tags/>标签</a>
<a class=menu-item href=https://xiaohei.im/categories/>分类</a>
<a class=menu-item href=https://xiaohei.im/about/>关于</a>
<a href=javascript:void(0); class=theme-switch><i class="fas fa-adjust fa-rotate-180 fa-fw"></i></a></div></div></nav><nav class=navbar-mobile><div class=navbar-container><div class=navbar-header><div class="navbar-header-title animated bounceIn"><a href=https://xiaohei.im/>xiaohei&#39;s blog | Java Developer</a></div><div class=menu-toggle id=menu-toggle><span></span><span></span><span></span></div></div><div class=navbar-menu id=mobile-menu><a class=menu-item href=https://xiaohei.im/posts/>文章</a>
<a class=menu-item href=https://xiaohei.im/tags/>标签</a>
<a class=menu-item href=https://xiaohei.im/categories/>分类</a>
<a class=menu-item href=https://xiaohei.im/about/>关于</a>
<a href=javascript:void(0); class=theme-switch><i class="fas fa-adjust fa-rotate-180 fa-fw"></i></a></div></div></nav><main class=main><div class=container><article class=post-warp><h1 class="post-title animated flipInX">RxJava入门</h1><div class=post-meta><div class=post-meta-main><a class=author href=https://xiaohei.im/ rel=author><i class="fas fa-user-circle fa-fw"></i>xiaoheiAh&nbsp;</a>
<span class=post-category>收录于
<i class="far fa-folder fa-fw"></i><a href=https://xiaohei.im/categories/hystrix/>Hystrix</a></span></div><div class=post-meta-other><i class="far fa-calendar-alt fa-fw"></i><time datetime=2019-08-21>2019-08-21</time>&nbsp;
<i class="fas fa-pencil-alt fa-fw"></i>约 4057 字&nbsp;
<i class="far fa-clock fa-fw"></i>预计阅读 9 分钟&nbsp;</div></div><div class=post-toc id=post-toc><h2 class=post-toc-title>目录</h2><div class=post-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#前言>前言</a></li><li><a href=#rxjava是什么>RxJava是什么</a><ul><li><a href=#reactive-x>Reactive X</a></li><li><a href=#概念>概念</a></li><li><a href=#hot-or-cold-observables>&ldquo;Hot&rdquo; or &ldquo;Cold&rdquo; Observables</a></li></ul></li><li><a href=#rxjava入门>RxJava入门</a><ul><li><a href=#hello-world>Hello World</a></li><li><a href=#操作符-operators>操作符 Operators</a><ul><li><a href=#创建型操作符>创建型操作符</a><ul><li><a href=#create>Create</a></li><li><a href=#defer>Defer</a></li><li><a href=#just>Just</a></li><li><a href=#interval>Interval</a><ul><li><a href=#参数>参数</a></li></ul></li></ul></li><li><a href=#转换操作符>转换操作符</a><ul><li><a href=#buffer>Buffer</a></li></ul></li><li><a href=#合并操作符>合并操作符</a><ul><li><a href=#zip>Zip</a></li></ul></li><li><a href=#背压操作符>背压操作符</a><ul><li><a href=#背压支持>背压支持</a></li><li><a href=#onbackpressurebuffer-onbackpressuredrop>onBackpressurebuffer/onBackpressureDrop</a></li></ul></li></ul></li></ul></li><li><a href=#总结>总结</a></li><li><a href=#参考>参考</a></li></ul></li></ul></nav></div></div><div class=post-toc-mobile id=post-toc-mobile><details><summary><div class=post-toc-title><span>目录</span><span><i class="details icon fas fa-angle-down"></i></span></div></summary><div class=post-toc-content><nav id=TableOfContentsMobile><ul><li><ul><li><a href=#前言>前言</a></li><li><a href=#rxjava是什么>RxJava是什么</a><ul><li><a href=#reactive-x>Reactive X</a></li><li><a href=#概念>概念</a></li><li><a href=#hot-or-cold-observables>&ldquo;Hot&rdquo; or &ldquo;Cold&rdquo; Observables</a></li></ul></li><li><a href=#rxjava入门>RxJava入门</a><ul><li><a href=#hello-world>Hello World</a></li><li><a href=#操作符-operators>操作符 Operators</a><ul><li><a href=#创建型操作符>创建型操作符</a><ul><li><a href=#create>Create</a></li><li><a href=#defer>Defer</a></li><li><a href=#just>Just</a></li><li><a href=#interval>Interval</a><ul><li><a href=#参数>参数</a></li></ul></li></ul></li><li><a href=#转换操作符>转换操作符</a><ul><li><a href=#buffer>Buffer</a></li></ul></li><li><a href=#合并操作符>合并操作符</a><ul><li><a href=#zip>Zip</a></li></ul></li><li><a href=#背压操作符>背压操作符</a><ul><li><a href=#背压支持>背压支持</a></li><li><a href=#onbackpressurebuffer-onbackpressuredrop>onBackpressurebuffer/onBackpressureDrop</a></li></ul></li></ul></li></ul></li><li><a href=#总结>总结</a></li><li><a href=#参考>参考</a></li></ul></li></ul></nav></div></details></div><div class=post-content><blockquote><p>本文基于 rxjava 1.x 版本</p></blockquote><a class=post-dummy-target id=前言></a><h2>前言</h2><p>写这篇文章是因为之前在看Hystrix时,觉得响应式编程很有意思,之前也了解到Spring5主打特性就是响应式,就想来试试水,入个门.本文主要介绍RxJava的特点,入门操作</p><a class=post-dummy-target id=rxjava是什么></a><h2>RxJava是什么</h2><a class=post-dummy-target id=reactive-x></a><h3>Reactive X</h3><p><code>ReactiveX</code>是使用<code>Observable</code>序列来组合异步操作且基于事件驱动的一个库.其继承自<a href=https://zh.wikipedia.org/wiki/观察者模式>观察者模式</a>来支持数据流或者事件流通过添加操作符(operators)的方式来声明式的操作,并抽象出对低级别线程(low-level thread),同步,线程安全,并发数据结构,非阻塞IO问题的关注.</p><p>ReactiveX 在不同语言中都有实现,RxJava 只是在JVM上实现的一套罢了.</p><a class=post-dummy-target id=概念></a><h3>概念</h3><blockquote><p>观察者模式是该框架的灵魂~</p></blockquote><p><figure><img src=/images/loading.svg data-sizes=auto data-src=https://i.loli.net/2019/08/21/PT56HZ2obO8vU3V.png alt=WX20190821-171445.png class=lazyload><figcaption class=image-caption>WX20190821-171445.png</figcaption></figure></p><p>上图可以表述为: <strong>观察者</strong>(Observer) <strong>订阅</strong>(subscribe)<strong>被观察者</strong>(Observable),当Observable产生事件或数据时,会调用Observer的方法进行回调.</p><p>听起来有点别扭,这里举一个形象点的例子.</p><p><strong>显示器开关</strong></p><p>显示器开关即为 Observable, 显示器为 Observer,这两个组件就会形成联系.当开关按下时,显示器就会通电点亮,这里即可抽象成Observable发出一个事件,Observer对事件做了处理.做什么样的处理其实在Subscribe时就已经决定了.</p><p><strong>回调方法</strong></p><p>在subscribe时会要求实现对应的回调方法,标准方法有以下三个:</p><ul><li><strong>onNext</strong></li></ul><p>Observable调用这个方法发射数据，方法的参数就是Observable发射的数据，这个方法可能会被调用多次，取决于你的实现。</p><ul><li><strong>onError</strong></li></ul><p>当Observable遇到错误或者无法返回期望的数据时会调用这个方法，这个调用会终止Observable，后续不会再调用onNext和onCompleted，onError方法的参数是抛出的异常。</p><ul><li><strong>onCompleted</strong></li></ul><p>正常终止，如果没有遇到错误，Observable在最后一次调用onNext之后调用此方法。</p><a class=post-dummy-target id=hot-or-cold-observables></a><h3>&ldquo;Hot&rdquo; or &ldquo;Cold&rdquo; Observables</h3><p>Observable何时开始发送数据呢?基于此问题,可以将Observable分为两类: <code>Hot</code> &amp; <code>Cold</code> . 可以理解为主动型和被动型.</p><p><strong>Hot Observable</strong>: Observable一经创建,就会开始发送数据. 所以后面订阅的Observer可能消费不到Observable完整的数据.</p><p><strong>Cold Observable</strong>: Observable会等到有Observer订阅时才开始发送数据,此时Observer会消费到完整的数据</p><a class=post-dummy-target id=rxjava入门></a><h2>RxJava入门</h2><a class=post-dummy-target id=hello-world></a><h3>Hello World</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=n>Observable</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=k>new</span> <span class=n>Observable</span><span class=p>.</span><span class=na>OnSubscribe</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=p>()</span> <span class=p>{</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=nf>void</span> <span class=n>call</span><span class=p>(</span><span class=n>Subscriber</span><span class=o>&lt;?</span> <span class=kd>super</span> <span class=nf>String</span><span class=o>&gt;</span> <span class=n>subscriber</span><span class=p>)</span> <span class=p>{</span>
      <span class=n>subscriber</span><span class=p>.</span><span class=na>onNext</span><span class=p>(</span><span class=s>&#34;Hello World&#34;</span><span class=p>);</span>
      <span class=n>subscriber</span><span class=p>.</span><span class=na>onCompleted</span><span class=p>();</span>
      <span class=c1>//subscriber.onError(new RuntimeException(&#34;error&#34;));
</span><span class=c1></span>    <span class=p>}</span>
  	<span class=p>}).</span><span class=na>subscribe</span><span class=p>(</span><span class=k>new</span> <span class=n>Subscriber</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=p>()</span> <span class=p>{</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=nf>void</span> <span class=n>onCompleted</span><span class=p>()</span> <span class=p>{</span>
      <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;观察结束啦~~~&#34;</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=nf>void</span> <span class=n>onError</span><span class=p>(</span><span class=n>Throwable</span> <span class=nf>e</span><span class=p>)</span> <span class=p>{</span>
      <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;观察出错啦~~~&#34;</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=nf>void</span> <span class=n>onNext</span><span class=p>(</span><span class=n>String</span> <span class=nf>s</span><span class=p>)</span> <span class=p>{</span>
      <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;onNext:&#34;</span> <span class=o>+</span> <span class=n>s</span><span class=p>);</span>
    <span class=p>}</span>
  <span class=p>});</span>
<span class=p>}</span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=c1>// onNext:Hello World
</span><span class=c1>// 观察结束啦~~~
</span><span class=c1>// 注释掉上一行 打开下一行注释 就会输出
</span><span class=c1>// onNext:Hello World
</span><span class=c1></span><span class=o>//</span> <span class=n>观察出错啦</span><span class=o>~~~</span></code></pre></td></tr></table></div></div><p>上述即为一个标准的创建观察者被观察者并订阅,实现订阅逻辑.</p><p><strong>疑问</strong></p><ol><li>为什么<code>subscribe</code>方法的参数是<code>Subscriber</code>呢?</li></ol><p>在rxjava中Observer是接口,Subscriber实现了Observer并提供了拓展.所以普遍用这个.</p><ol><li>为什么是Observable.subscribe(Observer)?用上面的显示器开关的例子来说就相当于显示器开关订阅显示器.</li></ol><p>为了保证流式风格~rxjava提供了一系列的操作符来对Observable发出的数据做处理,流式风格可以使操作符使用起来更友好.所以就当做Observable订阅了Observer吧🤦‍♂</p><a class=post-dummy-target id=操作符-operators></a><h3>操作符 Operators</h3><p>单纯的使用上面的<code>Hello World</code>撸码只能说是观察者模式的运用罢了,操作符才是<code>ReactiveX</code>最强大的地方.我们可以通过功能不同的操作符对Observable发出的数据做过滤(filter),转换(map)来满足业务的需求.其实就可以当作是Java8的<code>lambda</code>特性.</p><blockquote><p>Observable在经过操作符处理后还是一个Observable,对应上述的<strong>流式风格</strong></p></blockquote><p>案例: 假设我们需要监听鼠标在一个直角坐标系中的点击,取得所有在第一象限点击的坐标.</p><p><figure><img src=/images/loading.svg data-sizes=auto data-src=https://i.loli.net/2019/08/22/eQnOjomU7IufBpk.png alt=marble.png class=lazyload><figcaption class=image-caption>marble.png</figcaption></figure></p><p>从该流程图可以看出,鼠标点击后会发出很多数据,一次点击一个点,我们对数据进行filter,得到了下方时间轴上的数据源.这就是我们想要的.下面来看下常用的操作符有哪些?</p><a class=post-dummy-target id=创建型操作符></a><h4>创建型操作符</h4><blockquote><p>用于创建Observable对象的操作符</p></blockquote><a class=post-dummy-target id=create></a><h5>Create</h5><p>创建一个Observable,需要传递一个<code>Function</code>来完成调用Observer的逻辑.</p><p>一个标准的Observable必须只能调用一次(<strong>Exactly Once</strong>)<code>onCompleted</code>或者<code>onError</code>,并且在调用后不能再调用Observer的其他方法(eg: onNext).</p><p><strong>sample code</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=n>Observable</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=k>new</span> <span class=n>Observable</span><span class=p>.</span><span class=na>OnSubscribe</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span><span class=p>()</span> <span class=p>{</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=nf>void</span> <span class=n>call</span><span class=p>(</span><span class=n>Subscriber</span><span class=o>&lt;?</span> <span class=kd>super</span> <span class=nf>Integer</span><span class=o>&gt;</span> <span class=n>observer</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>try</span> <span class=p>{</span>
            <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>observer</span><span class=p>.</span><span class=na>isUnsubscribed</span><span class=p>())</span> <span class=p>{</span>
                <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=nf>i</span> <span class=o>=</span> <span class=n>1</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>5</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
                    <span class=n>observer</span><span class=p>.</span><span class=na>onNext</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
                <span class=p>}</span>
                <span class=n>observer</span><span class=p>.</span><span class=na>onCompleted</span><span class=p>();</span>
            <span class=p>}</span>
        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>Exception</span> <span class=nf>e</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>observer</span><span class=p>.</span><span class=na>onError</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>
 <span class=p>}</span> <span class=p>).</span><span class=na>subscribe</span><span class=p>(</span><span class=k>new</span> <span class=n>Subscriber</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span><span class=p>()</span> <span class=p>{</span>
        <span class=nd>@Override</span>
        <span class=kd>public</span> <span class=nf>void</span> <span class=n>onNext</span><span class=p>(</span><span class=n>Integer</span> <span class=nf>item</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Next: &#34;</span> <span class=o>+</span> <span class=n>item</span><span class=p>);</span>
        <span class=p>}</span>

        <span class=nd>@Override</span>
        <span class=kd>public</span> <span class=nf>void</span> <span class=n>onError</span><span class=p>(</span><span class=n>Throwable</span> <span class=nf>error</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>System</span><span class=p>.</span><span class=na>err</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Error: &#34;</span> <span class=o>+</span> <span class=n>error</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span>
        <span class=p>}</span>

        <span class=nd>@Override</span>
        <span class=kd>public</span> <span class=nf>void</span> <span class=n>onCompleted</span><span class=p>()</span> <span class=p>{</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Sequence complete.&#34;</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>});</span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>Next: <span class=m>1</span>
Next: <span class=m>2</span>
Next: <span class=m>3</span>
Next: <span class=m>4</span>
Sequence complete.</code></pre></td></tr></table></div></div><a class=post-dummy-target id=defer></a><h5>Defer</h5><p>直到有Observer订阅时才会创建,并且会为每一个Observer创建新的Observable,这样可以保证所有Observer可以看到相同的数据,并且从头开始消费.</p><p><strong>sample code</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=n>Observable</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=nf>defer</span> <span class=o>=</span> <span class=n>Observable</span><span class=p>.</span><span class=na>defer</span><span class=p>(</span><span class=k>new</span> <span class=n>Func0</span><span class=o>&lt;</span><span class=n>Observable</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;&gt;</span><span class=p>()</span> <span class=p>{</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=nf>Observable</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=nf>call</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>Observable</span><span class=p>.</span><span class=na>just</span><span class=p>(</span><span class=s>&#34;Hello&#34;</span><span class=p>,</span> <span class=s>&#34;World&#34;</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>});</span>

<span class=n>defer</span><span class=p>.</span><span class=na>subscribe</span><span class=p>(</span><span class=k>new</span> <span class=n>Subscriber</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=p>()</span> <span class=p>{</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=nf>void</span> <span class=n>onCompleted</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;第一个订阅完成啦~&#34;</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=nf>void</span> <span class=n>onError</span><span class=p>(</span><span class=n>Throwable</span> <span class=nf>e</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;第一个订阅报错啦~&#34;</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=nf>void</span> <span class=n>onNext</span><span class=p>(</span><span class=n>String</span> <span class=nf>s</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;第一个订阅收到:&#34;</span> <span class=o>+</span> <span class=n>s</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>});</span>

<span class=n>defer</span><span class=p>.</span><span class=na>subscribe</span><span class=p>(</span><span class=k>new</span> <span class=n>Subscriber</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=p>()</span> <span class=p>{</span>
		<span class=c1>//与上一个订阅逻辑相同
</span><span class=c1></span><span class=p>});</span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>第一个订阅收到:Hello
第一个订阅收到:World
第一个订阅完成啦~
第二个订阅收到:Hello
第二个订阅收到:World
第二个订阅完成啦~</code></pre></td></tr></table></div></div><p><strong>Note:</strong></p><p>Defer在RxJava中的实现其实有点像指派,可以看到构建时,传参为<code>Func0&lt;Observable&lt;T&gt;&gt;</code>,Observer真正订阅的是传参中的Observable.</p><a class=post-dummy-target id=just></a><h5>Just</h5><p>在上文<code>Defer</code>中代码中就用了<code>Just</code>,指的是可以发送特定的数据.代码一致就不作展示了.</p><a class=post-dummy-target id=interval></a><h5>Interval</h5><p>可以按照指定时间间隔从0开始发送无限递增序列.</p><a class=post-dummy-target id=参数></a><h6>参数</h6><ul><li>initalDelay 延迟多长时间开始第一次发送</li><li>period 指定时间间隔</li><li>unit 时间单位</li></ul><p>如下例子:延迟0秒后开始发送,每1秒发送一次. 因为sleep 100秒,会发送0-99终止</p><p><strong>sample code</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=n>Observable</span><span class=p>.</span><span class=na>interval</span><span class=p>(</span><span class=n>0</span><span class=p>,</span><span class=n>1</span><span class=p>,</span><span class=n>TimeUnit</span><span class=p>.</span><span class=na>SECONDS</span><span class=p>).</span><span class=na>subscribe</span><span class=p>(</span><span class=k>new</span> <span class=n>Action1</span><span class=o>&lt;</span><span class=n>Long</span><span class=o>&gt;</span><span class=p>()</span> <span class=p>{</span>
  	<span class=c1>// 这里只实现了OnNext方法,onError和onCompleted可以有默认实现.一种偷懒写法
</span><span class=c1></span>    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=nf>void</span> <span class=n>call</span><span class=p>(</span><span class=n>Long</span> <span class=nf>aLong</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>aLong</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>});</span>
<span class=k>try</span> <span class=p>{</span>
  	<span class=c1>//阻塞当前线程使程序一直跑
</span><span class=c1></span>    <span class=n>TimeUnit</span><span class=p>.</span><span class=na>SECONDS</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=n>100</span><span class=p>);</span>
<span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>InterruptedException</span> <span class=nf>e</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span>
<span class=p>}</span></code></pre></td></tr></table></div></div><a class=post-dummy-target id=转换操作符></a><h4>转换操作符</h4><blockquote><p>将Observable发出的数据进行各类转换的操作符</p></blockquote><a class=post-dummy-target id=buffer></a><h5>Buffer</h5><p><figure><img src=/images/loading.svg data-sizes=auto data-src=https://i.loli.net/2019/08/22/IC3vbhSDGgUYku5.png alt=buffer.png class=lazyload><figcaption class=image-caption>buffer.png</figcaption></figure></p><p>如上图所示,buffer定期将数据收集到集合中,并将集合打包发送.</p><p><strong>sample code</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=n>Observable</span><span class=p>.</span><span class=na>just</span><span class=p>(</span><span class=n>2</span><span class=p>,</span><span class=n>3</span><span class=p>,</span><span class=n>5</span><span class=p>,</span><span class=n>6</span><span class=p>)</span>
        <span class=p>.</span><span class=na>buffer</span><span class=p>(</span><span class=n>3</span><span class=p>)</span>
        <span class=p>.</span><span class=na>subscribe</span><span class=p>(</span><span class=k>new</span> <span class=n>Action1</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;&gt;</span><span class=p>()</span> <span class=p>{</span>
            <span class=nd>@Override</span>
            <span class=kd>public</span> <span class=nf>void</span> <span class=n>call</span><span class=p>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=nf>integers</span><span class=p>)</span> <span class=p>{</span>
                <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>integers</span><span class=p>);</span>
            <span class=p>}</span>
        <span class=p>});</span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=o>[</span><span class=m>2</span>, <span class=m>3</span>, <span class=m>5</span><span class=o>]</span>
<span class=o>[</span><span class=m>6</span><span class=o>]</span></code></pre></td></tr></table></div></div><p><strong>Window</strong></p><p>window和buffer是非常像的两个操作符,区别在于buffer会将存起来的item打包再发出去,而window则只是单纯的将item堆起来,达到阈值再发出去,不对原数据结构做修改.</p><p><figure><img src=/images/loading.svg data-sizes=auto data-src=https://i.loli.net/2019/08/22/kqIb5j6xfPDdOZn.png alt=window.png class=lazyload><figcaption class=image-caption>window.png</figcaption></figure></p><p><strong>sample code</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=n>Observable</span><span class=p>.</span><span class=na>just</span><span class=p>(</span><span class=n>2</span><span class=p>,</span><span class=n>3</span><span class=p>,</span><span class=n>5</span><span class=p>,</span><span class=n>6</span><span class=p>)</span>
        <span class=p>.</span><span class=na>window</span><span class=p>(</span><span class=n>3</span><span class=p>)</span>
        <span class=p>.</span><span class=na>subscribe</span><span class=p>(</span><span class=k>new</span> <span class=n>Action1</span><span class=o>&lt;</span><span class=n>Observable</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;&gt;</span><span class=p>()</span> <span class=p>{</span>
            <span class=nd>@Override</span>
            <span class=kd>public</span> <span class=nf>void</span> <span class=n>call</span><span class=p>(</span><span class=n>Observable</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=nf>integerObservable</span><span class=p>)</span> <span class=p>{</span>
                <span class=n>integerObservable</span><span class=p>.</span><span class=na>subscribe</span><span class=p>(</span><span class=k>new</span> <span class=n>Action1</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span><span class=p>()</span> <span class=p>{</span>
                    <span class=nd>@Override</span>
                    <span class=kd>public</span> <span class=nf>void</span> <span class=n>call</span><span class=p>(</span><span class=n>Integer</span> <span class=nf>integer</span><span class=p>)</span> <span class=p>{</span>
                        <span class=c1>// do anything
</span><span class=c1></span>                    <span class=p>}</span>
                <span class=p>});</span>
            <span class=p>}</span>
        <span class=p>});</span></code></pre></td></tr></table></div></div><a class=post-dummy-target id=合并操作符></a><h4>合并操作符</h4><blockquote><p>将多个Observable合并为一个的操作符</p></blockquote><a class=post-dummy-target id=zip></a><h5>Zip</h5><p>使用一个函数组合多个Observable发射的数据集合，然后再发射这个结果。如果多个Observable发射的数据量不一样，则以最少的Observable为标准进行组合.</p><p><figure><img src=/images/loading.svg data-sizes=auto data-src=https://i.loli.net/2019/08/22/Nu4TCMEHKGA3Y1V.png alt=zip.png class=lazyload><figcaption class=image-caption>zip.png</figcaption></figure></p><p><strong>sample code</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=n>Observable</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span>  <span class=nf>observable1</span><span class=o>=</span><span class=n>Observable</span><span class=p>.</span><span class=na>just</span><span class=p>(</span><span class=n>1</span><span class=p>,</span><span class=n>2</span><span class=p>,</span><span class=n>3</span><span class=p>,</span><span class=n>4</span><span class=p>);</span>
<span class=n>Observable</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span>  <span class=nf>observable2</span><span class=o>=</span><span class=n>Observable</span><span class=p>.</span><span class=na>just</span><span class=p>(</span><span class=n>4</span><span class=p>,</span><span class=n>5</span><span class=p>,</span><span class=n>6</span><span class=p>);</span>
<span class=n>Observable</span><span class=p>.</span><span class=na>zip</span><span class=p>(</span><span class=n>observable1</span><span class=p>,</span> <span class=n>observable2</span><span class=p>,</span> <span class=k>new</span> <span class=n>Func2</span><span class=o>&lt;</span><span class=n>Integer</span><span class=p>,</span> <span class=n>Integer</span><span class=p>,</span> <span class=n>String</span><span class=o>&gt;</span><span class=p>()</span> <span class=p>{</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=nf>String</span> <span class=n>call</span><span class=p>(</span><span class=n>Integer</span> <span class=nf>item1</span><span class=p>,</span> <span class=n>Integer</span> <span class=nf>item2</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>item1</span><span class=o>+</span><span class=s>&#34;and&#34;</span><span class=o>+</span><span class=n>item2</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}).</span><span class=na>subscribe</span><span class=p>(</span><span class=k>new</span> <span class=n>Action1</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=p>()</span> <span class=p>{</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=nf>void</span> <span class=n>call</span><span class=p>(</span><span class=n>String</span> <span class=nf>s</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>s</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>});</span> </code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>1and4
2and5
3and6</code></pre></td></tr></table></div></div><a class=post-dummy-target id=背压操作符></a><h4>背压操作符</h4><blockquote><p>用于平衡Observer消费速度,Observable生产速度的操作符</p></blockquote><p>背压是指在异步场景中,被观察者发送事件速度远快于观察者的处理速度的情况下，一种告诉上游的被观察者降低发送速度的策略.下图可以很好阐释背压机制是如何运行的.</p><p><figure><img src=/images/loading.svg data-sizes=auto data-src=https://i.loli.net/2019/09/02/4TyQFgBkIAO1R2c.png alt=backpressure.png class=lazyload><figcaption class=image-caption>backpressure.png</figcaption></figure></p><p>宗旨就是<strong>下游告诉上游我能处理多少你就给我发多少.</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=c1>//被观察者将产生100000个事件
</span><span class=c1></span><span class=n>Observable</span> <span class=nf>observable</span><span class=o>=</span><span class=n>Observable</span><span class=p>.</span><span class=na>range</span><span class=p>(</span><span class=n>1</span><span class=p>,</span><span class=n>100000</span><span class=p>);</span>
<span class=n>observable</span><span class=p>.</span><span class=na>observeOn</span><span class=p>(</span><span class=n>Schedulers</span><span class=p>.</span><span class=na>newThread</span><span class=p>())</span>
        <span class=p>.</span><span class=na>subscribe</span><span class=p>(</span><span class=k>new</span> <span class=n>Subscriber</span><span class=p>()</span> <span class=p>{</span>
            <span class=nd>@Override</span>
            <span class=kd>public</span> <span class=nf>void</span> <span class=n>onCompleted</span><span class=p>()</span> <span class=p>{</span>

            <span class=p>}</span>
            <span class=nd>@Override</span>
            <span class=kd>public</span> <span class=nf>void</span> <span class=n>onError</span><span class=p>(</span><span class=n>Throwable</span> <span class=nf>e</span><span class=p>)</span> <span class=p>{</span>

            <span class=p>}</span>
            <span class=nd>@Override</span>
            <span class=kd>public</span> <span class=nf>void</span> <span class=n>onNext</span><span class=p>(</span><span class=n>Object</span> <span class=nf>o</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>try</span> <span class=p>{</span>
                    <span class=n>TimeUnit</span><span class=p>.</span><span class=na>SECONDS</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=n>1</span><span class=p>);</span>
                <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>InterruptedException</span> <span class=nf>e</span><span class=p>)</span> <span class=p>{</span>
                    <span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span>
                <span class=p>}</span>
              	<span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;on Next Request...&#34;</span><span class=p>);</span>
                <span class=n>request</span><span class=p>(</span><span class=n>1</span><span class=p>);</span>
            <span class=p>}</span>
        <span class=p>});</span></code></pre></td></tr></table></div></div><a class=post-dummy-target id=背压支持></a><h5>背压支持</h5><p>上述样例代码中创建Observable使用的是<code>range</code>操作符,这是因为他是支持背压的,如果用<code>interval</code>,request的方法将不起作用.因为<code>interval</code>不支持背压.那什么样的Observable支持背压呢?</p><p>在前面介绍概念时,有提到过<code>Hot</code>&amp;<code>Cold</code>的区别,<code>Hot</code>类型的Observable,即一经创建就开始发送,<strong>不支持</strong>背压,<code>Cold</code>类型的Observable也只是<strong>部分</strong>支持.</p><a class=post-dummy-target id=onbackpressurebuffer-onbackpressuredrop></a><h5>onBackpressurebuffer/onBackpressureDrop</h5><p>不支持背压的操作符我们可以如何实现背压呢?就通过<code>onBackpressurebuffer/onBackpressureDrop</code>来实现.顾名思义一个是缓存,一个是丢弃.</p><p>这里以<code>drop</code>方式来展示.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=n>Observable</span><span class=p>.</span><span class=na>interval</span><span class=p>(</span><span class=n>1</span><span class=p>,</span> <span class=n>TimeUnit</span><span class=p>.</span><span class=na>MILLISECONDS</span><span class=p>)</span>
  <span class=p>.</span><span class=na>onBackpressureDrop</span><span class=p>()</span>
  <span class=c1>//指定observer调度io线程上,并将缓存size置为1,这个缓存会提前将数据存好在消费,
</span><span class=c1></span>  <span class=c1>//默认在PC上是128,设置小一点可以快速的看到drop的效果
</span><span class=c1></span>  <span class=p>.</span><span class=na>observeOn</span><span class=p>(</span><span class=n>Schedulers</span><span class=p>.</span><span class=na>io</span><span class=p>(),</span> <span class=n>1</span><span class=p>)</span>
  <span class=p>.</span><span class=na>subscribe</span><span class=p>(</span><span class=k>new</span> <span class=n>Subscriber</span><span class=o>&lt;</span><span class=n>Long</span><span class=o>&gt;</span><span class=p>()</span> <span class=p>{</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=nf>void</span> <span class=n>onCompleted</span><span class=p>()</span> <span class=p>{</span>

    <span class=p>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=nf>void</span> <span class=n>onError</span><span class=p>(</span><span class=n>Throwable</span> <span class=nf>e</span><span class=p>)</span> <span class=p>{</span>
      <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Error:&#34;</span> <span class=o>+</span> <span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span>
    <span class=p>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=nf>void</span> <span class=n>onNext</span><span class=p>(</span><span class=n>Long</span> <span class=nf>aLong</span><span class=p>)</span> <span class=p>{</span>
      <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;订阅 &#34;</span> <span class=o>+</span> <span class=n>aLong</span><span class=p>);</span>
      <span class=k>try</span> <span class=p>{</span>
        <span class=n>TimeUnit</span><span class=p>.</span><span class=na>MILLISECONDS</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=n>100</span><span class=p>);</span>
      <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>InterruptedException</span> <span class=nf>e</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span>
      <span class=p>}</span>
    <span class=p>}</span>
 	<span class=p>})</span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>订阅 <span class=m>0</span>
订阅 <span class=m>103</span>
订阅 <span class=m>207</span>
订阅 <span class=m>300</span>
订阅 <span class=m>417</span>
订阅 <span class=m>519</span>
订阅 <span class=m>624</span>
订阅 <span class=m>726</span>
订阅 <span class=m>827</span>
订阅 <span class=m>931</span>
订阅 <span class=m>1035</span>
订阅 <span class=m>1138</span>
订阅 <span class=m>1244</span>
订阅 <span class=m>1349</span></code></pre></td></tr></table></div></div><p>可以很明显的看出很多数据被丢掉了,这就是背压的效果.</p><a class=post-dummy-target id=总结></a><h2>总结</h2><p>写了这么多后,想来说说自己的感受.</p><ol><li>转变思想: 响应式编程的思想跟我们现在后端开发思路是有区别的.可能刚开始会不适应.</li><li>不易调试: 流式风格写着爽,调着难</li></ol><a class=post-dummy-target id=参考></a><h2>参考</h2><p><a href=http://reactivex.io/documentation/>ReactiveX官网</a></p><p><a href=https://zhuanlan.zhihu.com/p/24473022>关于RxJava最友好的文章——背压（Backpressure)</a></p><p><a href=http://zhangtielei.com/posts/blog-rxjava-backpressure.html>如何形象地描述RxJava中的背压和流控机制？</a></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>本文于 2019-08-21 更新</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=https://xiaohei.im/2019/08/21/posts/rxjava-guide/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section><span class=tag><a href=https://xiaohei.im/tags/rxjava/><i class="fas fa-tag fa-fw"></i>rxjava</a></span>
<span class=tag><a href=https://xiaohei.im/tags/%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B/><i class="fas fa-tag fa-fw"></i>响应式编程</a></span></section><section><span><a href=javascript:window.history.back();>返回</a></span>&nbsp;|&nbsp;<span><a href=https://xiaohei.im/>主页</a></span></section></div><div class=post-nav><a href=https://xiaohei.im/2019/08/21/posts/189-rotate-array/ class=prev rel=prev title="[LeetCode In Rust]189-Rotate Array"><i class="fas fa-angle-left fa-fw"></i>[LeetCode In Rust]189-Rotate Array</a>
<a href=https://xiaohei.im/2019/08/26/posts/rxjava-in-hystrix/ class=next rel=next title=Hystrix命令执行流程>Hystrix命令执行流程<i class="fas fa-angle-right fa-fw"></i></a></div></div><div class=post-comment><div id=gitalk-container></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css><script src=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js></script><script type=text/javascript>var gitalk=new Gitalk({id:"2019-08-21 16:09:48 \x2b0800 \x2b0800",title:"RxJava入门",clientID:"e38fc798c72a7e4e1386",clientSecret:"e151aa3b7b98d3cfaa1f096b88fdd7897e2c8007",repo:"xiaoheiAh.github.io",owner:"xiaoheiAh",admin:["xiaoheiAh"],body:decodeURI(location.href)});gitalk.render("gitalk-container");</script><noscript>Please enable JavaScript to view the <a href=https://github.com/gitalk/gitalk>comments powered by gitalk.</a></noscript></div></article></div></main><footer class=footer><div class=copyright><div class=copyright-line>由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreffer">Hugo</a> 强力驱动&nbsp;|&nbsp;主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="external nofollow noopener noreffer">LoveIt<i class="far fa-heart fa-fw"></i></a></div><div class=copyright-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2018 - 2019</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://xiaohei.im/>xiaoheiAh</a></span><span class=license>&nbsp;|&nbsp;<a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer><script src=/js/lib/jquery/jquery.slim.min.min.js></script><script src=/js/lib/lazysizes/lazysizes.min.min.js></script><script src=/js/lib/smooth-scroll/smooth-scroll.polyfills.min.min.js></script><script>window.scroll=new SmoothScroll('[data-scroll]',{speed:300,speedAsDuration:true});</script><script src=/js/blog.min.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-98254666-1','auto');ga('set','anonymizeIp',true);ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></div><a href=# class=dynamic-to-top id=dynamic-to-top data-scroll><span>&nbsp;</span></a></body></html>